<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PhantomFix Admin</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    input, textarea { width: 100%; margin: 0.5rem 0; padding: 0.5rem; font-size: 1rem; }
    button { padding: 0.5rem 1rem; font-size: 1rem; margin-top: 0.5rem; }
    .post { border-left: 4px solid #333; padding-left: 1rem; margin-top: 2rem; background: #f5f5f5; padding: 1rem; }
    .post button { margin-right: 1rem; }
    #uid-display { background: #222; color: #0f0; padding: 0.5rem; margin-bottom: 1rem; font-family: monospace; }
  </style>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDnkGOOycXmWORXmp9vudPIbapyvGh6W2A",
      authDomain: "phantomfix-blog.firebaseapp.com",
      projectId: "phantomfix-blog",
      storageBucket: "phantomfix-blog.firebasestorage.app",
      messagingSenderId: "524980957526",
      appId: "1:524980957526:web:b3e7a868b14b0d076c26f7",
      measurementId: "G-BQH28Z126C"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginForm = document.getElementById('login-form');
    const adminPanel = document.getElementById('admin-panel');
    const postsList = document.getElementById('posts');
    const blogForm = document.getElementById('blog-form');

    let currentUserUID = null;
    const allowedUID = "adminUID"; // Replace this later with your real UID

    onAuthStateChanged(auth, user => {
      // Remove any old UID display first
      const oldUID = document.getElementById('uid-display');
      if (oldUID) oldUID.remove();

      if (user) {
        currentUserUID = user.uid;

        // Show UID on top of page
        const uidDisplay = document.createElement('div');
        uidDisplay.id = 'uid-display';
        uidDisplay.textContent = 'Your Firebase UID: ' + currentUserUID;
        document.body.prepend(uidDisplay);

        if (user.uid === allowedUID || true) { // remove '|| true' after testing
          loginForm.style.display = 'none';
          adminPanel.style.display = 'block';
          loadPosts();
        } else {
          alert('Unauthorized user.');
          signOut(auth);
        }
      } else {
        loginForm.style.display = 'block';
        adminPanel.style.display = 'none';
      }
    });

    document.getElementById('login-btn').onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        alert('Login failed: ' + err.message);
      }
    };

    document.getElementById('logout-btn').onclick = () => {
      signOut(auth);
    };

    blogForm.onsubmit = async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      await addDoc(collection(db, 'posts'), { title, content, created: Date.now() });
      blogForm.reset();
      loadPosts();
    };

    async function loadPosts() {
      postsList.innerHTML = '';
      const snapshot = await getDocs(collection(db, 'posts'));
      snapshot.forEach(docSnap => {
        const post = docSnap.data();
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <h3>${post.title}</h3>
          <p>${post.content}</p>
          <button onclick="editPost('${docSnap.id}', '${encodeURIComponent(post.title)}', '${encodeURIComponent(post.content)}')">Edit</button>
          <button onclick="deletePost('${docSnap.id}')">Delete</button>
        `;
        postsList.appendChild(div);
      });
    }

    window.deletePost = async function(id) {
      await deleteDoc(doc(db, 'posts', id));
      loadPosts();
    };

    window.editPost = function(id, title, content) {
      const newTitle = prompt('Edit Title', decodeURIComponent(title));
      const newContent = prompt('Edit Content', decodeURIComponent(content));
      if (newTitle && newContent) {
        updateDoc(doc(db, 'posts', id), { title: newTitle, content: newContent });
        loadPosts();
      }
    };
  </script>
</head>
<body>
  <h1>PhantomFix Admin Panel</h1>

  <div id="login-form">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email" /><br />
    <input type="password" id="password" placeholder="Password" /><br />
    <button id="login-btn">Login</button>
  </div>

  <div id="admin-panel" style="display:none">
    <button id="logout-btn">Logout</button>
    <h2>New Blog Post</h2>
    <form id="blog-form">
      <input id="title" placeholder="Title" required /><br />
      <textarea id="content" placeholder="Content" required></textarea><br />
      <button type="submit">Publish</button>
    </form>

    <h2>All Blog Posts</h2>
    <div id="posts"></div>
  </div>
</body>
</html>
